{% extends "base.html" %}

{% block title %}{{ lesson.title }} - {{ language.name }} Reader{% endblock %}

{% block content %}
    {# Pass language ID to JS for API calls #}
    <div class="app-container" data-language-id="{{ language.id }}">
        <!-- Left Pane: Text Reader and Video Player -->
        <div class="left-pane">
            <div id="video-player-container">
                <!-- YouTube Player or Audio Player will be embedded here by JS -->
                <p>(Media Player Area)</p> 
            </div>

            <div id="text-container" 
                 data-lesson-id="{{ lesson.id }}"
                 data-raw-text="{{ lesson.text_content | escape }}">
                <h2>{{ lesson.title }}</h2>
                <!-- Placeholder for JS-parsed text -->
                <div id="parsed-text-area">
                    <p><i>Loading text...</i></p> 
                </div>
                <!-- Pagination Controls -->
                <div id="pagination-controls" style="text-align: center; padding: 10px; display: none;"> 
                    <button id="prev-page-btn" disabled>&lt; Prev</button>
                    <span id="page-info">Page 1 of 1</span>
                    <button id="next-page-btn" disabled>Next &gt;</button>
                </div>
            </div>
        </div>

        <!-- Right Pane: Dictionary and Word Editor -->
        <div class="right-pane">
            
            <div id="dictionary-results">
                <h3>Dictionary</h3>
                <div id="dict-content">
                    <p><i>Click a word to look it up.</i></p>
                </div>
            </div>

            <div id="word-editor">
                <h3>Edit Term</h3>
                <div id="editor-content" style="display: none;">
                    <p><strong>Term:</strong> <span id="editor-term">-</span></p>
                    <p><strong>Status:</strong> <span id="editor-status">-</span></p>
                    
                    <div class="status-selector">
                        <button class="status-btn" data-status="1">1</button>
                        <button class="status-btn" data-status="2">2</button>
                        <button class="status-btn" data-status="3">3</button>
                        <button class="status-btn" data-status="4">4</button>
                        <button class="status-btn" data-status="5">5</button>
                        <button class="status-btn" data-status="6">Known</button>
                        <button class="status-btn" data-status="7">Ignored</button>
                    </div>
                    
                    <br>
                    <label for="edit-translation">Translation:</label><br>
                    <textarea id="edit-translation" rows="3"></textarea><br>
                    <button id="save-translation">Save Translation</button>
                </div>
                <div id="editor-placeholder" style="display: block;">
                    <p><i>Click a word to edit its status or translation.</i></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Pass media info to JS -->
    <script>
        // Use tojson to correctly handle None -> null and escape strings
        const lessonYoutubeUrl = {{ lesson.youtube_url | tojson }}; 
        const lessonAudioFilename = {{ lesson.audio_filename | tojson }};
        
        // Construct full audio URL if filename exists, correcting the path
        const lessonAudioUrl = lessonAudioFilename 
            ? "{{ url_for('static', filename='uploads/audio/') }}" + lessonAudioFilename 
            : null; // Use null if no audio filename
    </script>

    <!-- Link to the JavaScript file -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>
{% endblock %}
