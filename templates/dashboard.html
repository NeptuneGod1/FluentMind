{% extends "base.html" %}

{% block title %}Dashboard - FluentMind{% endblock %}

{% block content %}
    <div id="banner"
         {% if banner_image %}
             style="background-image: url('{{ url_for('static', filename='uploads/' + banner_image) }}');"
         {% endif %}
    >
        <!-- Buttons for banner actions -->
        <div class="banner-actions">
            <button class="banner-action-btn" id="change-cover-btn" title="Change Cover"><small>Change</small></button>
            <button class="banner-action-btn" id="reposition-btn" title="Reposition"><small>Reposition</small></button>
        </div>

        <!-- Background image set dynamically or via CSS default -->
        <div class="banner-overlay">
            <h1>The Coziest Language Study Corner</h1>
        </div>
    </div>

    <div class="dashboard-content">
        <h2>Select a Language</h2>
        <div class="language-cards-container">
            <!-- Language cards will be generated here -->
            {% for lang in languages %}
                <!-- Wrap the entire card content in a link -->
                <a href="{{ url_for('language_lessons', lang_name=lang.name.lower()) }}" class="language-card-link">
                    <div class="language-card" data-language-id="{{ lang.id }}">
                        {# --- Use the actual background image --- #}
                        <div class="language-card-image" 
                             {% if lang.card_background_image %}
                                 style="background-image: url('{{ url_for('static', filename='uploads/language_bg/' + lang.card_background_image) }}'); background-position: {{ lang.card_background_position or 'center' }};"
                             {% else %}
                                 style="background-color: #eee; display: flex; align-items: center; justify-content: center; color: #aaa; font-size: 0.9em;"
                             {% endif %}>
                             {% if lang.card_background_image %}
                             <div class="image-controls" onclick="event.preventDefault(); event.stopPropagation();">
                                 <button class="reposition-btn" title="Reposition Image" onclick="event.preventDefault(); event.stopPropagation();">
                                     <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                         <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/>
                                     </svg>
                                 </button>
                             </div>
                             <div class="reposition-overlay" style="display: none;" onclick="event.preventDefault(); event.stopPropagation();">
                                 <div class="reposition-instructions">Click and drag to reposition image</div>
                                 <button class="save-position-btn">Save Position</button>
                                 <button class="cancel-position-btn">Cancel</button>
                             </div>
                             {% endif %}
                             {# Show text only if there is NO image #}
                             {% if not lang.card_background_image %}
                                <span>(No Image)</span>
                             {% endif %}
                        </div>
                        {# --- Card Content Below Image --- #}
                        <div class="language-card-content"> {# Add a content wrapper #}
                            <h3>{{ lang.name }}</h3>
                            <p>Level: {{ lang.level or 'N/A' }} | {{ lang.days_learning }} days</p>
                            
                            {# --- Add Progress Bar Elements --- #}
                            <div class="progress-bar-container">
                                <div class="progress-bar" style="width: {{ lang.progress_percent }}%;"></div>
                            </div>
                            <span class="progress-percent" title="{{ lang.known_count }} / {{ target_known_words or 10000 }} words known">
                                {{ "%.1f"|format(lang.progress_percent) }}%
                            </span>
                            {# --- End Progress Bar Elements --- #}
                        </div>
                    </div>
                </a>
            {% else %}
                <p>No languages added yet. Add one in Settings!</p>
            {% endfor %}
        </div>
    </div>

    <!-- Maybe add a footer later -->
{% endblock %} 